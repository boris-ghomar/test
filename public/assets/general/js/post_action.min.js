class PostAction{constructor(e,t=!1){this.apiBaseUrl=e,this.debugMode=t,this.modalLoading=new Modal_loading;var o=new ModalRealize("modalRealize_PostAction");o.setHeader(trans("result.failed")),this.modalRealize=o;var n=new ModalCustom("modalLoginRequired_PostAction");n.setHeader(trans("result.failed")),n.setBody(loginReqired),n.setCustomBtnLabel(signInBtnLabel),n.setOnCustomBtnPressed((function(){window.location.href=loginPageUrl})),this.modalLoginRequired=n}log(e,t="log"){if(this.debugMode&&!this.isEmpty(e))switch(t){case"log":default:console.log(e);break;case"error":console.error(e);break;case"warn":console.warn(e)}}isEmpty(e){return null==e||(null==e||""==e)}getView(e,t=!1){try{var o=document.getElementById(e);return is_ElementExist(o)?o:null}catch(o){t&&(alert("No view found with this ID: "+e),this.log(o))}return null}displayView(e,t=!0){var o=this.getView(e);if(is_ElementExist(o)){var n="d-none",a=func_hasClass(o,n);t&&a?toggleElementClass(e,n):t||a||toggleElementClass(e,n)}}isLoginRequired(e){return"thisApp.Errors.loginRequired"==e}goToAnchorLink(){var e=document.location.href.split("#"),t=e.length;if(t>1){var o=e[t-1],n=document.getElementById(o);is_ElementExist(n)&&(n.scrollIntoView(),n.getElementsByClassName("comment-box")[0].classList.add("selected-comment"))}}getServerConnection(e,t=null){this.modalLoading.show();var o=new ServerConnection(this.apiBaseUrl);return o.setSubUrl("user_actions/"+e),o.setMethod("POST"),o.appendHeader("locale",locale),o.setOnFailed(function(e,o,n){var a=JSON.parse(e.responseText),s="";if("string"==typeof a.message)s=a.message;else try{a.message.forEach((e=>{s+="* "+e+"\n<br>"}))}catch(e){s=JSON.stringify(a.message,null,2)}"exception.CSRF token mismatch."==s&&window.location.reload(),null!=a.data&&!0===a.data.refreshPage&&window.location.reload(),this.log(s),this.isLoginRequired(a.error)?this.modalLoginRequired.create():(this.modalRealize.setBody(s),this.modalRealize.create()),null!=t&&t(a,s),this.modalLoading.close()}.bind(this)),o}like(e,t){var o=document.getElementById(e+"_icon"),n=document.getElementById(e+"_counter"),a=this.getServerConnection("like");a.appendData("key",t),a.setOnSuccess((e=>{e=JSON.parse(e),toggleElementClass(o.id,"fa-solid"),toggleElementClass(o.id,"liked");var t=e.data.likesCount;n.innerHTML=t,this.modalLoading.close()})),a.connect()}comment(e,t){var o=document.getElementById(e+"_counter"),n=document.getElementById(e+"_comment"),a=this.getServerConnection("comment");a.appendData("key",t),a.appendData("comment",n.value),a.setOnSuccess((e=>{var t=(e=JSON.parse(e)).data.commentsCount,a=e.data.reload,s=e.data.anchorLink;o.innerHTML=t,n.value="";var l=this.modalRealize;l.setHeader(successCommentTitle),l.setBody(e.message),this.modalLoading.close(),this.modalRealize.create(),a&&(history.replaceState(null,null,s),window.location.href=s,window.location.reload())})),a.connect()}}
