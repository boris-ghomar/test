class RegistrationController{constructor(e){this.apiBaseUrl=e,this.debugMode=!1,this.modalLoading=new Modal_loading,this.provincesCitiesCollection=[],this.provinceSelectView=func_getView("province_internal"),this.citySelectView=func_getView("city_internal"),func_isEmpty(this.citySelectView)||(this.selectedCity=func_getView(this.citySelectView.id+"_selectedItem").value,this.provinceSelectView.addEventListener("change",(e=>{this.provinceChanged()}))),this.provinceChanged()}getServerConnection(e,i=null,t=!0){t&&this.modalLoading.show();var s=new ServerConnection(this.apiBaseUrl);return s.setSubUrl("registration/"+e),s.setMethod("POST"),s.appendHeader("locale",locale),s.appendData("_apiAction",e),s.setOnFailed(function(e,t,s){var n=JSON.parse(e.responseText);if(this.modalRealize.setHeader(trans("result.failed")),"string"==typeof n.message)this.modalRealize.setBody(n.message);else{var a="";try{n.message.forEach((e=>{a+="* "+e+"\n"}))}catch(e){a=JSON.stringify(n.message,null,2)}this.modalRealize.setBody(a)}"exception.CSRF token mismatch."==a&&window.location.reload(),null!=n.data&&!0===n.data.refreshPage&&window.location.reload(),this.modalLoading.close(),this.modalRealize.create(),null!=i&&i(n)}.bind(this)),s}provinceChanged(){if(func_isEmpty(this.citySelectView))return;let e=this.provincesCitiesCollection,i=this.provinceSelectView.value,t=e[i];if(func_isEmpty(t)){var s=this.getServerConnection("get_cities");s.appendData("province",i),s.setOnSuccess(function(e){let t=JSON.parse(e).data.cities;this.provincesCitiesCollection[i]=t,this.modifyCitiesDropdown(t),this.modalLoading.close()}.bind(this)),s.connect()}else this.modifyCitiesDropdown(t)}modifyCitiesDropdown(e){let i=this.citySelectView;i.innerHTML="";var t=!1;func_forEach(e,((e,s)=>{let n=document.createElement("option");n.value=s,n.innerHTML=e,s==this.selectedCity&&(n.selected="selected"),i.appendChild(n),t=!0})),func_displayView(i.id+"-widget",t)}sendEmailVerification(){let e=func_getView("email").value;var i=this.getServerConnection("send_email_verification");i.appendData("email",e),i.setOnSuccess(function(e){var i=JSON.parse(e);i.data;this.modalLoading.close(),this.modalRealize.setHeader(trans("result.success")),this.modalRealize.setBody(i.message),this.modalRealize.setOnClose((()=>{window.location.reload()})),this.modalRealize.create()}.bind(this)),i.connect()}}
