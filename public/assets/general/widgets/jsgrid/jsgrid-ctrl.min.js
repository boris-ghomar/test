class jsGridController{constructor(e,t){this.ContainerId=e,this.apiBaseUrl=t,this.setLocale("en"),this.setupStringFormat(),this.modalRealize=new ModalRealize("modalRealize_Ctrl_"+this.ContainerId),this.modalConfirm=new ModalConfirm("modalConfirm_Ctrl_"+this.ContainerId)}setupStringFormat(){String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,(function(t,r){return void 0!==e[r]?e[r]:t}))})}create(){var e=this.getjsGridScriptElement();e.innerHTML="",e.innerHTML+=this.getLocaleTag()}config(e){var t=JSON.parse(JSON.stringify(e),(function(e,t){return"string"==typeof t&&t.startsWith("hhh_java(")&&t.endsWith(")")?(t=t.substring(9,t.length-1),(0,eval)("("+t+")")):t}));return this.setCustomLoadStrategy(t)}setCustomLoadStrategy(e){var t=function(e){jsGrid.loadStrategies.PageLoadingStrategy.call(this,e)};return(t.prototype=new jsGrid.loadStrategies.PageLoadingStrategy).finishDelete=function(e,t){var r=this._grid;r.option("data").splice(t,1),r.refresh()},e.loadStrategy=function(){return new t(this)},e}getjsGridScriptElement(){return document.getElementById(this.ContainerId+"Script")}setLocale(e){this.locale=e}getLocale(){return this.locale}getLocaleTag(){return"{0}.locale('{1}')".format(this.ContainerId,this.getLocale())}appendItems(e,t){Object.keys(t).forEach((r=>{""!=r&&null!=r&&e.appendData(r,t[r])}))}appendHeaders(e){e.appendHeader("locale",this.getLocale())}setupBaseConnection(e,t,r){var n=new ServerConnection(this.apiBaseUrl);return n.setSubUrl(e),this.appendHeaders(n),this.appendItems(n,t),n.setOnFailed(function(e,t,n){var a=JSON.parse(e.responseText);if(this.modalRealize.setHeader(trans("server.ServerError")+":\n "+e.status+" : "+e.statusText),"string"==typeof a.message)this.modalRealize.setBody(a.message);else{var i="";try{a.message.forEach((e=>{i+="* "+e+"\n"}))}catch(e){i=JSON.stringify(a.message,null,2)}this.modalRealize.setBody(i)}this.modalRealize.create(),r.reject()}.bind(this)),n}addRowNumber(e){var t=e.data;try{if(Array.isArray(t)&&t.length>0){var r=(e.meta.current_page-1)*e.meta.per_page;t.forEach((e=>{r++,e.Row=r}))}}catch(e){alert(e.message)}return t}loadDataService(e,t){var r=$.Deferred(),n=this.setupBaseConnection(e,t,r);return n.setMethod("POST"),n.setOnSuccess(function(e){var t={itemsCount:(e=JSON.parse(e)).meta.total,data:this.addRowNumber(e)};r.resolve(t)}.bind(this)),n.connect(),r.promise()}insertItemService(e,t){var r=$.Deferred(),n=this.setupBaseConnection(e,t,r);return n.setMethod("POST"),n.setOnSuccess((function(e){var t=(e=JSON.parse(e)).data;r.resolve(t)})),n.connect(),r.promise()}updateItemService(e,t){var r=$.Deferred(),n=this.setupBaseConnection(e,t,r);return n.setMethod("POST"),n.appendData("_method","PUT"),n.setOnSuccess((function(e){var n=(e=JSON.parse(e)).data;"Row"in t&&(n.Row=t.Row),r.resolve(n)})),n.connect(),r.promise()}deleteItemService(e,t){var r=$.Deferred(),n=this.setupBaseConnection(e,t,r);return n.setMethod("POST"),n.appendData("_method","DELETE"),n.setOnSuccess(function(e){e=JSON.parse(e);showSuccessToast(e.message),r.resolve()}.bind(this)),n.connect(),r.promise()}exportExcelService(){showInfoToast(trans("export.reviewMessage"));var e=document.getElementById("btnExportExcel");e.disabled=!0,setTimeout((function(){e.disabled=!1}),5e3);var t=subUrl+"/export_excel",r=$("#"+this.ContainerId).jsGrid("getFilter"),n=$("#"+this.ContainerId).jsGrid("getSorting");void 0!==n.field&&void 0!==n.order&&(r.sortField=n.field,r.sortOrder=n.order);var a=$.Deferred(),i=this.setupBaseConnection(t,r,a);return i.setMethod("POST"),i.setOnSuccess(function(e){e=JSON.parse(e);showSuccessToast(e.message),document.getElementById("iframeDownloadFile").src=e.data.downloadLink}.bind(this)),i.connect(),a.promise()}updateCustomizeTableSettings(){var e=subUrl+"/update_customize_table_settings",t=$.Deferred();let r=document.querySelectorAll('input[name="customizablePageColumns[]"]:checked'),n=[];r.forEach((e=>{n.push(e.value)}));let a={customizablePageSelectedColumns:JSON.stringify(n)};var i=this.setupBaseConnection(e,a,t);return i.setMethod("POST"),i.setOnSuccess(function(e){e=JSON.parse(e);window.location.reload()}.bind(this)),i.connect(),t.promise()}setupNoDataScrollView(){var e=document.getElementById(this.ContainerId),t=e.getElementsByClassName("jsgrid-header-row")[0],r=e.getElementsByClassName("jsgrid-nodata-row")[0];if(is_ElementExist(r)){var n=r.getElementsByClassName("jsgrid-cell")[0];n.style.width=n.offsetWidth+"px",n.colSpan=1;var a=document.createElement("td");a.className="jsgrid-cell",a.style.width=t.offsetWidth-n.offsetWidth+"px",r.appendChild(a)}}}(function(jsGrid,$,undefined){var DateField=function(e){this.dateViewType=e.dateViewType,jsGrid.Field.call(this,e)};DateField.prototype=new jsGrid.Field({sorter:function(e,t){return new Date(e)-new Date(t)},itemTemplate:function(e){return this._getDateView(e)},filterTemplate:function(){if(!this.filtering)return"";var e=this._grid,t=this.filterControl=this.insertTemplate();return this.autosearch&&(t.on("change",(function(t){e.search(),t.preventDefault()})),t.on("keypress",(function(t){13===t.which&&(e.search(),t.preventDefault())}))),t},insertTemplate:function(e){return!this.inserting||this.readOnly?"":this._insertPicker=$("<input>").datepicker({defaultDate:new Date,dateFormat:"yy-mm-dd"})},editTemplate:function(e){return!this.editing||this.readOnly?this.itemTemplate.apply(this,arguments):this._editPicker=$("<input>").datepicker({dateFormat:"yy-mm-dd"}).datepicker("setDate",new Date(e))},filterValue:function(){return this.filterControl.val()},insertValue:function(){try{return this._insertPicker.datepicker("getDate").toDateString()}catch(e){return""}},editValue:function(){try{return this._editPicker.datepicker("getDate").toDateString()}catch(e){return""}},_getDateView:function(value){try{var dateViewType=this.dateViewType,CustomKeyword="CustomFormat:";if(dateViewType.startsWith(CustomKeyword)){var dateFormat=dateViewType.replace(CustomKeyword,"");return $.datepicker.formatDate(dateFormat,new Date(value))}var dateFunc='new Date("'+value+'").'+dateViewType+"();";return eval(dateFunc)}catch(e){return new Date(value).toDateString()}}}),jsGrid.fields.date=jsGrid.DateField=DateField})(jsGrid,jQuery),function(e,t,r){var n=e.Field;function a(e){n.call(this,e)}a.prototype=new n({autosearch:!0,readOnly:!1,filterTemplate:function(){if(!this.filtering)return"";var e=this._grid,t=this.filterControl=this._createDateRangeBox();return this.autosearch&&t.on("keypress",(function(t){13===t.which&&(e.search(),t.preventDefault())})),t},insertTemplate:function(){return this.inserting?this.insertControl=this._createTextBox():""},editTemplate:function(e){if(!this.editing)return this.itemTemplate.apply(this,arguments);var t=this.editControl=this._createTextBox();return t.val(e),t},filterValue:function(){var e={fromDate:this.filterControl.children().val(),toDate:this.filterControl.children().next().val()};return JSON.stringify(e)},insertValue:function(){return this.insertControl.val()},editValue:function(){return this.editControl.val()},_createTextBox:function(){return t("<input>").attr("type","text").prop("readonly",!!this.readOnly).on("input",(function(e){element=e.target,value=element.value,element.value=value.replace(/[^0-9/\-: ]/g,"")}))},_createDateRangeBox:function(){var e=t("<div>").prop("readonly",!!this.readOnly);t("<input>").attr("type","text").prop("readonly",!!this.readOnly).prop("id","from_date").prop("placeholder",trans("date.fromDate")).on("input",(function(e){element=e.target,value=element.value,element.value=value.replace(/[^0-9/\-: ]/g,"")})).appendTo(e),t("<input>").attr("type","text").prop("readonly",!!this.readOnly).prop("id","to_date").prop("placeholder",trans("date.toDate")).on("input",(function(e){element=e.target,value=element.value,element.value=value.replace(/[^0-9/\-: ]/g,"")})).appendTo(e);return e.prop("disabled",!!this.readOnly),e}}),e.fields.date_range=e.DateRangeField=a}(jsGrid,jQuery),function(e,t,r){var n=e.Field;function a(e){n.call(this,e)}a.prototype=new n({autosearch:!0,readOnly:!1,filterTemplate:function(){if(!this.filtering)return"";var e=this._grid,t=this.filterControl=this._createNumberRangeBox();return this.autosearch&&t.on("keypress",(function(t){13===t.which&&(e.search(),t.preventDefault())})),t},insertTemplate:function(){return this.inserting?this.insertControl=this._createTextBox():""},editTemplate:function(e){if(!this.editing)return this.itemTemplate.apply(this,arguments);var t=this.editControl=this._createTextBox();return t.val(String(e).replaceAll(",","")),t},filterValue:function(){var e={fromNumber:this.filterControl.children().val(),toNumber:this.filterControl.children().next().val()};return JSON.stringify(e)},insertValue:function(){return this.insertControl.val()},editValue:function(){return this.editControl.val()},_createTextBox:function(){return t("<input>").attr("type","number").prop("readonly",!!this.readOnly).on("input",(function(e){element=e.target,value=element.value}))},_createNumberRangeBox:function(){var e=t("<div>").prop("readonly",!!this.readOnly);t("<input>").attr("type","number").prop("readonly",!!this.readOnly).prop("id","from_number").prop("placeholder",trans("number.fromNumber")).on("input",(function(e){element=e.target,value=element.value})).appendTo(e),t("<input>").attr("type","number").prop("readonly",!!this.readOnly).prop("id","to_number").prop("placeholder",trans("number.toNumber")).on("input",(function(e){element=e.target,value=element.value})).appendTo(e);return e.prop("disabled",!!this.readOnly),e}}),e.fields.number_range=e.NumberRangeField=a}(jsGrid,jQuery);
